# 导出功能说明

## 功能概述

新增了将聊天内容导出为 Word 和 PDF 格式的功能，支持：

1. **单条消息导出** - 在每条 AI 回复消息上显示导出按钮
2. **整个会话导出** - 在页面头部显示导出整个会话的按钮

## 安装依赖

在使用导出功能之前，需要安装以下依赖包：

```bash
npm install docx jspdf html2canvas
```

或者使用 yarn：

```bash
yarn add docx jspdf html2canvas
```

## 功能特点

### Word 导出
- 使用 `docx` 库生成标准的 .docx 文件
- 支持格式化文本（标题、段落、换行）
- 包含消息发送者、时间戳信息
- 自动处理转义的换行符

### PDF 导出
- 使用 `jsPDF` 库生成 PDF 文件
- 支持中文字符显示
- 自动分页处理
- 包含完整的会话信息

## 使用方法

### 1. 单条消息导出

在 AI 回复的消息上，鼠标悬停时会显示导出按钮：
- 📄 Word - 导出为 Word 文档
- 📋 PDF - 导出为 PDF 文档

### 2. 整个会话导出

在页面头部（当有消息时显示）：
- 📄 导出Word - 导出整个会话为 Word 文档
- 📋 导出PDF - 导出整个会话为 PDF 文档

## 技术实现

### 核心文件

1. **`src/utils/exportUtils.js`** - 导出功能核心模块
   - `exportToWord()` - Word 导出函数
   - `exportToPDF()` - PDF 导出函数
   - `cleanHtmlContent()` - 内容清理函数

2. **`src/components/ChatMessage.vue`** - 聊天消息组件
   - 添加了单条消息导出按钮
   - 集成导出功能调用

3. **`src/views/ManusApp.vue`** - 超级智能体页面
   - 添加了会话级导出按钮
   - 实现批量导出功能

4. **`src/views/InspectorApp.vue`** - 疾控监督专家页面
   - 添加了会话级导出按钮
   - 实现批量导出功能

### 内容处理

导出功能会自动处理以下内容格式：
- 转义的换行符 (`\\n` → 换行)
- HTML 标签清理
- Markdown 格式转换
- 特殊字符转义

### 文件命名

导出的文件会自动命名为：
- Word: `{标题}_{日期}.docx`
- PDF: `{标题}_{日期}.pdf`

例如：`超级智能体会话记录_2025-01-10.docx`

## 样式说明

### 导出按钮样式
- 鼠标悬停时显示（opacity 动画）
- Word 按钮：蓝色主题 (#2b579a)
- PDF 按钮：红色主题 (#dc3545)
- 支持悬停和点击效果

### 响应式设计
- 在移动设备上按钮会适当调整大小
- 保持良好的用户体验

## 错误处理

导出功能包含完善的错误处理：
- 依赖库加载失败检测
- 内容处理异常捕获
- 用户友好的错误提示
- 控制台详细错误日志

## 测试

提供了测试页面 `test-export.html` 用于验证导出功能：
- 独立的 HTML 页面
- 包含测试数据
- 可以直接在浏览器中测试导出功能

## 浏览器兼容性

支持现代浏览器：
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 注意事项

1. **文件大小限制**：大量消息可能导致文件较大，建议分批导出
2. **中文字体**：PDF 导出在某些环境下可能需要额外的中文字体支持
3. **权限要求**：需要浏览器允许文件下载
4. **内存使用**：大量内容导出时可能占用较多内存

## 未来改进

可能的功能扩展：
- 支持更多导出格式（如 Excel、纯文本）
- 自定义导出模板
- 批量选择特定消息导出
- 云端存储集成
- 导出进度显示

## 故障排除

### 常见问题

1. **导出按钮不显示**
   - 检查是否为 AI 消息
   - 确认鼠标悬停在消息上

2. **导出失败**
   - 检查浏览器控制台错误信息
   - 确认依赖包已正确安装
   - 检查浏览器是否允许文件下载

3. **中文显示异常**
   - PDF 导出时可能需要额外的字体支持
   - 建议使用 Word 导出获得更好的中文支持

4. **文件无法打开**
   - 确认使用正确的应用程序打开
   - Word 文档需要 Microsoft Word 或兼容软件
   - PDF 文档需要 PDF 阅读器
